{% extends 'base.html'%} {% block content %}
<div class="view full-page">
  <!-- Mask & flexbox options-->
  <div class="white container mt-5 pt-5">
    <h1 class="display-4">All Books</h1>
    <form
      class="form-inline d-flex justify-content-center md-form form-sm active-pink-2 mt-2"
      method="POST" action="" id="searchForm" name="searchForm"
    >
      <input
        class="form-control form-control-sm mr-3 w-75"
        type="text"
        placeholder="Search"
        aria-label="Search"
        name="search"
        id="search"
        value="{{ request.form['search'] }}"
      />
      <i class="fas fa-search" aria-hidden="true"></i>
    </form>
    {{ pagination.links }}
    <div class="sort">
      Sort By:
      <a href="{{ url_for('get_books') }}">Title</a> /
      <a href="{{ url_for('get_books_year') }}">Year</a> /
      <a href="{{ url_for('get_books_isbn') }}">ISBN</a>
    </div>
    <div
      class="md-accordion accordion"
      role="tablist"
      id="accordionEx"
      aria-multiselectable="false"
    >
      {% for books in books %}

      <div class="card">
        <div class="card-header" role="tab" id="heading{{ loop.index }}">
          <a
            data-toggle="collapse"
            data-parent="#accordionEx"
            href="#collapse{{ loop.index }}"
            data-expanded="true"
            aria-controls="collapse{{ loop.index }}"
          >
            <h5 class="mb-0">
              {{ books.title }}
              <i class="fas fa-angle-down"></i>
            </h5>
          </a>
        </div>
        <div
          id="collapse{{ loop.index }}"
          class="collapse"
          role="tabpanel"
          aria-labelledby="heading{{ loop.index }}"
        >
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                <img src="{{ books.image_url }}" alt="book-image" />
                <h5>Authors: {{ books.authors }}</h5>
                <p>ISBN: {{ books.isbn13 }}</p>
                <p>Published: {{ books.original_publication_year }}</p>
                <p>Language: {{ books.language_code }}</p>
                <p>Goodreads Rating: {{ books.average_rating }}/5</p>
                <p>User Rating:/5</p>
                
              </div>
              <div class="col-md-8">
                <div class="row">
                  <div class="col-4">
                    <form
                      method="POST"
                      action="{{ url_for('add_review', user_id=user._id, book_id=books._id) }}"
                    >
                      <button class="btn btn-indigo btn-sm">
                        Add Review
                        <i class="fas fa-comments"></i>
                      </button>
                    </form>
                  </div>
                  <div class="col-4">
                    <form
                      method="POST"
                      action="{{ url_for('edit_book', book_id=books._id) }}"
                    >
                      <button
                        class="btn btn-warning btn-sm"
                        name="edit"
                        value=""
                      >
                        Edit Book
                        <i class="fas fa-edit ml-2"></i>
                      </button>
                    </form>
                  </div>
                  <div class="col-4">
                    <form method="POST">
                      <button
                        class="btn btn-red btn-sm"
                        name="delete"
                        formaction="{{ url_for('delete', id=books._id) }}"
                      >
                        Delete Book
                        <i class="fas fa-times ml-2"></i>
                      </button>
                    </form>
                  </div>
                </div>
                <h4>Description</h4>
                {% if books.description == null %}
                <p>Sorry No Description Yet!</p>
                {% endif %} {{ books.description }}

                <h4>Reviews</h4>
                
                {% if books.no_of_reviews == 0 %}
                <p>Sorry No Reviews Yet!</p>
                {% elif books.no_of_reviews == null %}
                <p>Sorry No Reviews Yet!</p>
                {% endif %}

                {% for review in books.reviews|sort(reverse=true, attribute='date') %}
            
                <div class="row">
                  <div
                    class="col-md-2 d-flex justify-content-center align-content-center flex-wrap"
                  >
                    <div class="image-cropper">
                      <img
                        src="{{ url_for('user_upload', filename=review['user_image']) }}"
                        alt="Review Poster"
                        width="80"
                        class="poster-image"
                      />
                    </div>
                  </div>
                  <div class="col-md-10">
                    <p><b>Review</b> {{ review.review.capitalize() }}</p>
                    <p><b>Posted By:</b> {{ review.user.capitalize() }}</p>
                    <p><b>Posted</b> {{ review.time_of_post }}</p>
                  </div>
                </div>
                <hr>
                {% endfor%}
              </div>
            </div>
          </div>
        </div>
      </div>

      {% endfor %}
    </div>
    {{ pagination.links }} {{ pagination.info }}
  </div>
</div>
{% include "footer.html" %} {% endblock %}
