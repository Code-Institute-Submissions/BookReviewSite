{% extends 'base.html'%} {% set active_page = "books" %} {% block content %}
<div class="view full-page">
  <div class="min-vh-100 white container pt-5">
    <div class="row">
      <div class="col-md-5 mb-4 mt-5 d-flex align-items-center flex-column">
        <h1 class="mt-5 text-center">{{ book.title }}</h1>
        <h4>{{ book.authors }} - {{ book.original_publication_year }}</h4>
        {% if book.user_rating_average == none %} {% if book.average_rating ==
        null or book.average_rating.to_decimal() == 0.0 %}
        <p>Not Yet Rated!</p>
        {% elif book.average_rating.to_decimal() <= 1.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.average_rating.to_decimal() <= 2.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.average_rating.to_decimal() <= 3.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.average_rating.to_decimal() <= 4.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.average_rating.to_decimal() <= 5.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
        </div>
        {% endif %} {% else %} {% if book.user_rating_average == none %}
        <p>Not Yet Rated!</p>
        {% elif book.user_rating_average.to_decimal() <= 1.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.user_rating_average.to_decimal() <= 2.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.user_rating_average.to_decimal() <= 3.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.user_rating_average.to_decimal() <= 4.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star grey-text"></span>
        </div>
        {% elif book.user_rating_average.to_decimal() <= 5.5 %}
        <div class="flex-row">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
        </div>
        {% endif %} {% endif %}
        <img src="{{ book.image_url }}" alt="" width="200" />
        <form method="POST">
          <div
            class="btn-group-vertical"
            role="group"
            aria-label="Vertical button group"
          >
            <button
              class="btn btn-dark-green"
              name="buy"
              formtarget="_blank"
              rel="noreferrer"
              formaction="https://www.amazon.co.uk/s?k={{ book.title | replace('#', '%23') }}&i=stripbooks&camp=1634&creative=6738&linkCode=ur2&linkId=ee18cd3e629a75b55215c65c6ccb51a4&tag=kushberry-21"
            >
              Buy On Amazon!
              <i class="fas fa-shopping-basket ml-2"></i>
            </button>
            <button
              formaction="{{ url_for('add_review', book_id=book._id) }}"
              class="btn btn-amber btn-sm"
            >
              Add Review
              <i class="fas fa-comments"></i>
            </button>
            {% if book.description == none or book.description == null or
            book.image_url ==
            "https://cdn.bookauthority.org/dist/images/book-cover-not-available.6b5a104fa66be4eec4fd16aebd34fe04.png"
            or book.image_url == none or book.image_url == "" %}
            <button
              formaction="{{ url_for('edit_book', book_id=book._id) }}"
              class="btn btn-deep-purple btn-sm"
              name="edit"
            >
              Edit Book
              <i class="fas fa-edit ml-2"></i>
            </button>
            {% endif %} 
            {% if book.posted_by == null and session['user'] != 'admin' %}            
            {% elif session['user'] == 'admin' or session['user'] ==
            book.posted_by %}
            <button
              class="btn btn-danger btn-sm"
              name="delete"
              formaction="{{ url_for('delete', id=book._id) }}"
            >
              Delete Book
              <i class="fas fa-times ml-2"></i>
            </button>
            {% endif %}
          </div>
        </form>
      </div>
      <div class="col-md-7 mb-4 mt-5 pt-5">
        <h2 class="pb-4">Description</h2>
        {% if book.description == null or book.description == none or
        book.description == "" %}
        <div class="reviews-desc-placeholder flex-center">
          <h4>Sorry No Description Yet!</h4>
        </div>
        {% endif %} {% if book.description is not none %}
        <p style="white-space: pre-wrap;">{{ book.description }}</p>
        {% endif %}

        <h2 class="pb-4">Reviews</h2>
        {% if book.no_of_reviews == 0 or book.no_of_reviews == null %}
        <div class="reviews-desc-placeholder flex-center">
          <h4>Sorry No Reviews Yet!</h4>
        </div>
        {% endif %} {%- for reviews in book.reviews|sort(reverse=true,
        attribute='date') %}
        <div class="row w-100">
          <div class="col-4 d-flex justify-content-center">
            <div class="d-flex justify-content-start flex-wrap mt-4 flex-column">
              <div class="image-cropper mx-auto">
                <img
                  src="{{ url_for('user_upload', filename=reviews['user_image']) }}"
                  alt="Review Poster"
                  width="80"
                  class="poster-image"
                />
              </div>
              <p class="mb-0 text-center posted-by">
                <b>Posted By:</b> {{ reviews.user.capitalize() }}
              </p>
              <p class="text-center posted-by">{{ reviews.date | humanize }}</p>
            </div>
          </div>
          <div class="col-8">
            <p class="mb-1" style="white-space: pre-line;">
              {{ reviews.review.capitalize() }}
            </p>
            {% if reviews.user_rating == 1 %}
            <div class="pb-2">
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star"></span>
              <span class="fa fa-star"></span>
              <span class="fa fa-star"></span>
              <span class="fa fa-star"></span>
            </div>
            {% elif reviews.user_rating == 2 %}
            <div class="pb-2">
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star"></span>
              <span class="fa fa-star"></span>
              <span class="fa fa-star"></span>
            </div>
            {% elif reviews.user_rating == 3 %}
            <div class="pb-2">
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star"></span>
              <span class="fa fa-star"></span>
            </div>
            {% elif reviews.user_rating == 4 %}
            <div class="pb-2">
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star"></span>
            </div>
            {% elif reviews.user_rating == 5 %}
            <div class="pb-2">
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
              <span class="fa fa-star checked"></span>
            </div>
            {% endif %}
          </div>
        </div>
        <hr class="{% if loop.last %}d-none{% endif %}" />
        {%- endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
